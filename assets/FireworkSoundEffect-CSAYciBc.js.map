{"version":3,"file":"FireworkSoundEffect-CSAYciBc.js","sources":["../../src/views/practice/components/FireworkSoundEffect.vue"],"sourcesContent":["<template>\n  <div class=\"firework-sound-effect\"></div>\n</template>\n\n<script setup lang=\"ts\">\nimport { toRefs, watch } from 'vue'\nimport confetti from 'canvas-confetti'\n\ninterface Props {\n  triggerFirework?: boolean\n  triggerSound?: boolean\n  isCorrect?: boolean\n  soundVolume?: number\n}\n\ninterface Emits {\n  (e: 'effect-complete'): void\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  triggerFirework: false,\n  triggerSound: false,\n  isCorrect: true,\n  soundVolume: 0.5\n})\n\nconst emit = defineEmits<Emits>()\nconst propsRefs = toRefs(props)\n\n// Shared AudioContext to prevent audio context issues\nlet audioContextInstance: AudioContext | null = null\n\n// Get or create shared audio context\nconst getAudioContext = () => {\n  if (!audioContextInstance || audioContextInstance.state === 'closed') {\n    audioContextInstance = new (window.AudioContext || (window as any).webkitAudioContext)()\n  }\n  return audioContextInstance\n}\n\n// Create synthetic audio sounds using Web Audio API\nconst createSuccessSound = () => {\n  try {\n    const audioContext = getAudioContext()\n    \n    // Resume context if suspended (required by some browsers)\n    if (audioContext.state === 'suspended') {\n      audioContext.resume()\n    }\n    \n    // Create a cheerful success sound (ascending notes)\n    const playNote = (frequency: number, startTime: number, duration: number) => {\n      const oscillator = audioContext.createOscillator()\n      const gainNode = audioContext.createGain()\n      \n      oscillator.connect(gainNode)\n      gainNode.connect(audioContext.destination)\n      \n      oscillator.frequency.setValueAtTime(frequency, startTime)\n      oscillator.type = 'sine'\n      \n      // Envelope - smoother gain curve\n      gainNode.gain.setValueAtTime(0, startTime)\n      gainNode.gain.linearRampToValueAtTime(props.soundVolume * 0.4, startTime + 0.02)\n      gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + duration)\n      \n      oscillator.start(startTime)\n      oscillator.stop(startTime + duration)\n      \n      // Prevent memory leaks\n      oscillator.onended = () => {\n        oscillator.disconnect()\n        gainNode.disconnect()\n      }\n    }\n    \n    const now = audioContext.currentTime\n    // Play a cheerful chord progression: C-E-G (major chord) with longer duration\n    playNote(523.25, now, 0.5)        // C5\n    playNote(659.25, now + 0.15, 0.5)  // E5  \n    playNote(783.99, now + 0.3, 0.6)  // G5\n    \n  } catch (error) {\n    console.warn('Web Audio API not supported:', error)\n  }\n}\n\nconst createErrorSound = () => {\n  try {\n    const audioContext = getAudioContext()\n    \n    // Resume context if suspended\n    if (audioContext.state === 'suspended') {\n      audioContext.resume()\n    }\n    \n    // Create a descending error sound\n    const oscillator = audioContext.createOscillator()\n    const gainNode = audioContext.createGain()\n    \n    oscillator.connect(gainNode)\n    gainNode.connect(audioContext.destination)\n    \n    // Start high and slide down - longer duration\n    const now = audioContext.currentTime\n    oscillator.frequency.setValueAtTime(400, now)\n    oscillator.frequency.exponentialRampToValueAtTime(180, now + 0.8)\n    oscillator.type = 'sawtooth'\n    \n    // Smoother gain envelope\n    gainNode.gain.setValueAtTime(0, now)\n    gainNode.gain.linearRampToValueAtTime(props.soundVolume * 0.5, now + 0.02)\n    gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.8)\n    \n    oscillator.start(now)\n    oscillator.stop(now + 0.8)\n    \n    // Prevent memory leaks\n    oscillator.onended = () => {\n      oscillator.disconnect()\n      gainNode.disconnect()\n    }\n    \n  } catch (error) {\n    console.warn('Web Audio API not supported:', error)\n  }\n}\n\n// Trigger firework effect\nconst triggerFireworkEffect = () => {\n  if (!props.triggerFirework) return\n  \n  if (props.isCorrect) {\n    // Hiệu ứng pháo hoa cho câu trả lời đúng\n    confetti({\n      particleCount: 100,\n      spread: 70,\n      origin: { y: 0.6 },\n      colors: ['#00ff00', '#32cd32', '#7cfc00', '#adff2f', '#9aff9a']\n    })\n    \n    // Pháo hoa từ 2 bên\n    setTimeout(() => {\n      confetti({\n        particleCount: 50,\n        angle: 60,\n        spread: 55,\n        origin: { x: 0, y: 0.8 },\n        colors: ['#ffd700', '#ffff00', '#ffffe0', '#fffacd']\n      })\n    }, 200)\n    \n    setTimeout(() => {\n      confetti({\n        particleCount: 50,\n        angle: 120,\n        spread: 55,\n        origin: { x: 1, y: 0.8 },\n        colors: ['#ff69b4', '#ff1493', '#ffb6c1', '#ffc0cb']\n      })\n    }, 400)\n  } else {\n    // Hiệu ứng nhỏ cho câu trả lời sai\n    confetti({\n      particleCount: 30,\n      spread: 45,\n      origin: { y: 0.7 },\n      colors: ['#ff4444', '#ff6666', '#ff8888', '#ffaaaa'],\n      gravity: 1.2,\n      scalar: 0.8\n    })\n  }\n}\n\n// Play sound effect using synthetic audio\nconst playSoundEffect = () => {\n  if (!props.triggerSound) return\n  \n  try {\n    if (props.isCorrect) {\n      createSuccessSound()\n    } else {\n      createErrorSound()\n    }\n  } catch (error) {\n    console.warn('Sound playback error:', error)\n    playFallbackSound(props.isCorrect)\n  }\n}\n\n// Fallback sound using Web Audio API\nconst playFallbackSound = (isCorrect: boolean) => {\n  try {\n    const audioContext = getAudioContext()\n    \n    // Resume context if suspended\n    if (audioContext.state === 'suspended') {\n      audioContext.resume()\n    }\n    \n    const now = audioContext.currentTime\n    \n    if (isCorrect) {\n      // Success sound: play multiple notes in sequence\n      const frequencies = [523, 659, 784] // C5, E5, G5\n      frequencies.forEach((freq, index) => {\n        const oscillator = audioContext.createOscillator()\n        const gainNode = audioContext.createGain()\n        \n        oscillator.connect(gainNode)\n        gainNode.connect(audioContext.destination)\n        \n        const startTime = now + (index * 0.15)\n        oscillator.frequency.setValueAtTime(freq, startTime)\n        oscillator.type = 'sine'\n        \n        gainNode.gain.setValueAtTime(0, startTime)\n        gainNode.gain.linearRampToValueAtTime(props.soundVolume * 0.4, startTime + 0.02)\n        gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + 0.4)\n        \n        oscillator.start(startTime)\n        oscillator.stop(startTime + 0.4)\n        \n        oscillator.onended = () => {\n          oscillator.disconnect()\n          gainNode.disconnect()\n        }\n      })\n    } else {\n      // Error sound: single descending tone\n      const oscillator = audioContext.createOscillator()\n      const gainNode = audioContext.createGain()\n      \n      oscillator.connect(gainNode)\n      gainNode.connect(audioContext.destination)\n      \n      oscillator.frequency.setValueAtTime(400, now)\n      oscillator.frequency.exponentialRampToValueAtTime(200, now + 0.6)\n      oscillator.type = 'sawtooth'\n      \n      gainNode.gain.setValueAtTime(0, now)\n      gainNode.gain.linearRampToValueAtTime(props.soundVolume * 0.5, now + 0.02)\n      gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.6)\n      \n      oscillator.start(now)\n      oscillator.stop(now + 0.6)\n      \n      oscillator.onended = () => {\n        oscillator.disconnect()\n        gainNode.disconnect()\n      }\n    }\n  } catch (error) {\n    console.warn('Web Audio API fallback failed:', error)\n  }\n}\n\n// Main trigger function\nconst triggerEffects = () => {\n  if (props.triggerFirework || props.triggerSound) {\n    triggerFireworkEffect()\n    playSoundEffect()\n    \n    // Emit completion event after animations\n    setTimeout(() => {\n      emit('effect-complete')\n    }, 1000)\n  }\n}\n\n// Watch for prop changes\nconst { triggerFirework, triggerSound, isCorrect } = toRefs(props)\n\nwatch([triggerFirework, triggerSound], ([newFirework, newSound]) => {\n  if (newFirework || newSound) {\n    triggerEffects()\n  }\n}, { immediate: false })\n\n// Cleanup audio context when component unmounts\nimport { onUnmounted } from 'vue'\n\nonUnmounted(() => {\n  if (audioContextInstance && audioContextInstance.state !== 'closed') {\n    // Don't close immediately, let current sounds finish\n    setTimeout(() => {\n      if (audioContextInstance && audioContextInstance.state !== 'closed') {\n        audioContextInstance.close()\n        audioContextInstance = null\n      }\n    }, 1000)\n  }\n})\n\n// No need for onMounted/onUnmounted with synthetic audio\n\n// Expose methods for manual triggering\ndefineExpose({\n  triggerEffects,\n  triggerFireworkEffect,\n  playSoundEffect\n})\n</script>\n\n<style scoped>\n.firework-sound-effect {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  z-index: 9999;\n}\n</style>\n"],"names":["isCorrect","_openBlock","_createElementBlock"],"mappings":"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"}