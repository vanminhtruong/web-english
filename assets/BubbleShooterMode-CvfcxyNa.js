import{A as t,d as e,C as s,D as a,I as i,q as o,J as r,c as n,v as h,f as l,t as c,u as d,e as u,y as x,w as B,Y as g}from"./vue-vendor-Bt65BSdi.js";import{u as v}from"./ui-vendor-D-J_fEQ5.js";import"./voiceStore-o6lhlGgY.js";import{u as m}from"./useAudioSystem-zpNfV08l.js";import{_ as b}from"./_plugin-vue_export-helper-BCo6x5W8.js";class p{score=t(0);wordsMatched=t(0);gameOver=t(!1);bubbles=t([]);shootingBubble=t(null);currentShooterWord=t("");currentShooterColor=t("#FF6B6B");explosions=t([]);particles=t([]);screenShake=t({x:0,y:0,intensity:0});aimLine=t({visible:!1,x:0,y:0});shooterPosition=t({x:400,y:550});rowAnimationActive=t(!1);wordColorMap=new Map;COLORS=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#FFB347"];resetGame(){this.score.value=0,this.wordsMatched.value=0,this.gameOver.value=!1,this.bubbles.value=[],this.shootingBubble.value=null,this.explosions.value=[],this.particles.value=[],this.screenShake.value={x:0,y:0,intensity:0},this.aimLine.value={visible:!1,x:0,y:0},this.currentShooterWord.value="",this.currentShooterColor.value="#FF6B6B"}updateScore(t){this.score.value+=t}incrementWordsMatched(){this.wordsMatched.value+=1}setGameOver(t){this.gameOver.value=t}setRowAnimationActive(t){this.rowAnimationActive.value=t}addBubble(t){this.bubbles.value.push(t)}removeBubbles(t){this.bubbles.value=this.bubbles.value.filter(e=>!t.includes(e.id))}setShootingBubble(t){this.shootingBubble.value=t}selectNextShooterWord(t){if(t.length>0){const e=t[Math.floor(Math.random()*t.length)];this.currentShooterWord.value=e.word,this.currentShooterColor.value=this.getColorForWord(e.word)}}updateAimLine(t){t?this.aimLine.value={visible:!0,x:t.x,y:t.y}:this.aimLine.value.visible=!1}addExplosion(t){this.explosions.value.push(t)}updateExplosions(){this.explosions.value.forEach(t=>{if(!t.active)return;t.shockwave.radius<t.shockwave.maxRadius&&(t.shockwave.radius+=2,t.shockwave.intensity=Math.max(0,1-t.shockwave.radius/t.shockwave.maxRadius));let e=0;t.particles.forEach(t=>{if(t.life>0){switch(t.x+=t.vx,t.y+=t.vy,t.rotation+=t.rotationSpeed,t.type){case"burst":t.vy+=.15,t.vx*=.96,t.vy*=.96,t.life-=.025;break;case"spark":t.vy+=.05,t.vx*=.99,t.vy*=.99,t.life-=.04;break;case"glow":t.vy+=.08,t.vx*=.97,t.vy*=.97,t.life-=.015}e++}}),0===e&&t.shockwave.radius>=t.shockwave.maxRadius&&(t.active=!1)}),this.updateScreenShake(),this.explosions.value=this.explosions.value.filter(t=>t.active)}addScreenShake(t){this.screenShake.value.intensity=Math.max(this.screenShake.value.intensity,t)}updateScreenShake(){this.screenShake.value.intensity>0&&(this.screenShake.value.x=(Math.random()-.5)*this.screenShake.value.intensity,this.screenShake.value.y=(Math.random()-.5)*this.screenShake.value.intensity,this.screenShake.value.intensity*=.9,this.screenShake.value.intensity<.1&&(this.screenShake.value.intensity=0,this.screenShake.value.x=0,this.screenShake.value.y=0))}getColorForWord(t){if(!this.wordColorMap.has(t)){let e=0;for(let a=0;a<t.length;a++)e=(e<<5)-e+t.charCodeAt(a)&4294967295;const s=Math.abs(e)%this.COLORS.length;this.wordColorMap.set(t,this.COLORS[s])}return this.wordColorMap.get(t)}}class f{BUBBLE_SIZE=40;COLORS=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#FFB347"];CONTACT_EPS=8;wordColorMap=new Map;stateManager;constructor(t){this.stateManager=t}getColorForWord(t){if(!this.wordColorMap.has(t)){let e=0;for(let a=0;a<t.length;a++)e=(e<<5)-e+t.charCodeAt(a)&4294967295;const s=Math.abs(e)%this.COLORS.length;this.wordColorMap.set(t,this.COLORS[s])}return this.wordColorMap.get(t)}checkCollision(t,e){const s=e.x-t.x,a=e.y-t.y;return Math.sqrt(s*s+a*a)<=this.BUBBLE_SIZE}animateShootingBubble(t,e,s,a,i,o=800,r=600){let n=0;let h=e,l=s;const c=()=>{if(t.x+=h,t.y+=l,i)for(const n of i){const e=this.stateManager?.rowAnimationActive.value,s=e&&(n.row??0)<0,c=s?n.x:e&&void 0!==n.stableX?n.stableX:n.x,d=s?this.BUBBLE_SIZE/2:e&&void 0!==n.stableY?n.stableY:n.y,u=t.x-c,x=t.y-d,B=Math.sqrt(u*u+x*x);if(B<=this.BUBBLE_SIZE+this.CONTACT_EPS&&u*h+x*l<=0){console.log("Collision/near-contact detected! Computing tangent and triple-contact placement");let e=u,s=x,n=B;if(n<.01){e=-h||0,s=-l||-1;const t=Math.sqrt(e*e+s*s)||1;e/=t,s/=t}else e/=n,s/=n;const g=c+e*this.BUBBLE_SIZE,v=d+s*this.BUBBLE_SIZE;if(t.x=g,t.y=v,i)this.snapToGrid(t,i),this.forceToNearestFreeSeat(t,i,o,r);else{const e=this.BUBBLE_SIZE*Math.sqrt(3)/2,s=this.BUBBLE_SIZE/2,a=this.BUBBLE_SIZE/2;t.row=Math.max(0,Math.round((t.y-a)/e)),t.col=Math.max(0,Math.round((t.x-s)/this.BUBBLE_SIZE))}return h=0,l=0,void a(t)}}if((t.x<=this.BUBBLE_SIZE/2||t.x>=o-this.BUBBLE_SIZE/2)&&(h=.8*-h,n++,t.x=Math.max(this.BUBBLE_SIZE/2,Math.min(o-this.BUBBLE_SIZE/2,t.x))),t.y<=this.BUBBLE_SIZE/2){t.y=this.BUBBLE_SIZE/2;const e=this.BUBBLE_SIZE/2,s=Math.round((t.x-e)/this.BUBBLE_SIZE);t.x=e+s*this.BUBBLE_SIZE,t.row=0,t.col=Math.max(0,s),l=0,n=3}t.y>=r-this.BUBBLE_SIZE/2&&(t.y=r-this.BUBBLE_SIZE/2,l=0,n=3),n>0&&l>2&&(l+=.05);const e=Math.abs(h)<3&&Math.abs(l)<3,s=t.x<=this.BUBBLE_SIZE/2+20,d=t.x>=o-this.BUBBLE_SIZE/2-20,u=t.y<=this.BUBBLE_SIZE/2+20,x=n>0&&(e&&(s||d)||u&&Math.abs(l)<2);if(t.y<=this.BUBBLE_SIZE/2&&l<=0||n>=3||x){if(i&&i.length>0){const e=this.BUBBLE_SIZE+this.CONTACT_EPS;let s=null,n=Number.POSITIVE_INFINITY;for(const a of i){const i=this.stateManager?.rowAnimationActive.value,o=i&&(a.row??0)<0,r=o?a.x:i&&void 0!==a.stableX?a.stableX:a.x,c=o?this.BUBBLE_SIZE/2:i&&void 0!==a.stableY?a.stableY:a.y,d=t.x-r,u=t.y-c,x=Math.sqrt(d*d+u*u);d*h+u*l>0||x<e&&x<n&&(s=a,n=x)}if(s){const e=this.stateManager?.rowAnimationActive.value,n=e&&(s.row??0)<0,h=n?s.x:e&&void 0!==s.stableX?s.stableX:s.x,l=n?this.BUBBLE_SIZE/2:e&&void 0!==s.stableY?s.stableY:s.y;let c=t.x-h,d=t.y-l;const u=Math.sqrt(c*c+d*d)||1;c/=u,d/=u;const x=h+c*this.BUBBLE_SIZE,B=l+d*this.BUBBLE_SIZE,g=this.findTripleContactPosition(s,i,{x:x,y:B},o,r),v=g?g.x:x,m=g?g.y:B;return t.x=v,t.y=m,this.snapToGrid(t,i),this.forceToNearestFreeSeat(t,i,o,r),void a(t)}}a(t)}else requestAnimationFrame(c)};c()}findTripleContactPosition(t,e,s,a,i){const o=this.BUBBLE_SIZE,r=this.BUBBLE_SIZE/2,n=(t,e,s,a)=>{const i=s-t,r=a-e,n=Math.sqrt(i*i+r*r);if(n<1e-6||n>2*o)return[];const h=n/2,l=o*o-h*h;if(l<-1e-6)return[];const c=l>0?Math.sqrt(Math.max(0,l)):0,d=t+h*i/n,u=e+h*r/n,x=-r*c/n,B=i*c/n;return[{x:d+x,y:u+B},{x:d-x,y:u-B}]},h=(t,e)=>t>=r&&t<=a-r&&e>=r&&e<=i-r,l=(t,s)=>{for(const a of e){const e=a.x-t,i=a.y-s;if(Math.sqrt(e*e+i*i)<this.BUBBLE_SIZE-.1)return!1}return!0},c=e.filter(e=>e!==t).filter(e=>{const s=e.x-t.x,a=e.y-t.y,i=Math.sqrt(s*s+a*a);return i>.5*this.BUBBLE_SIZE&&i<1.5*this.BUBBLE_SIZE});let d=null,u=Number.POSITIVE_INFINITY;for(const x of c){const e=n(t.x,t.y,x.x,x.y);for(const t of e){if(!h(t.x,t.y))continue;if(!l(t.x,t.y))continue;const e=t.x-s.x,a=t.y-s.y,i=e*e+a*a;i<u&&(d=t,u=i)}}return d}getQuantizedBaseY(t){if(!t||0===t.length)return this.BUBBLE_SIZE/2;const e=this.BUBBLE_SIZE*Math.sqrt(3)/2,s=this.BUBBLE_SIZE/2,a=this.stateManager?.rowAnimationActive.value;if(a){const a=t.filter(t=>(t.row??0)>=0);if(0===a.length)return s;const i=Math.min(...a.map(t=>t.row??0)),o=s+i*e;return console.log("getQuantizedBaseY (ANIMATION): minRow =",i,"quantized baseY =",o),o}{const a=Math.min(...t.map(t=>t.row??0)),i=s+a*e;return console.log("getQuantizedBaseY (NORMAL): minRow =",a,"quantized baseY =",i),i}}getSeatCenter(t,e,s){const a=this.BUBBLE_SIZE*Math.sqrt(3)/2,i=this.BUBBLE_SIZE/2,o=this.getQuantizedBaseY(s),r=this.getTopRowOffset(s);return{x:i+(t%2==0?r:0===r?this.BUBBLE_SIZE/2:0)+e*this.BUBBLE_SIZE,y:o+t*a}}getTopRowOffset(t){const e=this.BUBBLE_SIZE,s=e/2,a=this.stateManager?.rowAnimationActive.value,i=t.filter(t=>0===(t.row??0));if(0===i.length)return 0;let o=0,r=0;for(const n of i){const t=a&&void 0!==n.stableX?n.stableX:n.x,i=s+Math.round((t-s)/e)*e,h=s+e/2+Math.round((t-(s+e/2))/e)*e;o+=Math.abs(t-i),r+=Math.abs(t-h)}return o<=r?0:e/2}isSeatOccupied(t,e,s){const a=this.stateManager?.rowAnimationActive.value;for(const i of s){const s=(a&&void 0!==i.stableX?i.stableX:i.x)-t,o=(a&&void 0!==i.stableY?i.stableY:i.y)-e;if(Math.sqrt(s*s+o*o)<=.25)return!0}return!1}forceToNearestFreeSeat(t,e,s,a){const i=this.BUBBLE_SIZE/2,o=(t,e)=>t>=i&&t<=s-i&&e>=i&&e<=a-i;let r=this.getSeatCenter(t.row,t.col,e);if(o(r.x,r.y)&&!this.isSeatOccupied(r.x,r.y,e))return t.x=r.x,void(t.y=r.y);let n=null,h=Number.POSITIVE_INFINITY;for(let l=-2;l<=2;l++){const s=Math.max(0,t.row+l);for(let a=-2;a<=2;a++){const i=Math.max(0,t.col+a);if(r=this.getSeatCenter(s,i,e),!o(r.x,r.y))continue;if(this.isSeatOccupied(r.x,r.y,e))continue;const l=r.x-t.x,c=r.y-t.y,d=l*l+c*c;d<h&&(h=d,n={row:s,col:i,x:r.x,y:r.y})}}n?(t.row=n.row,t.col=n.col,t.x=n.x,t.y=n.y):(t.x=Math.max(i,Math.min(s-i,r.x)),t.y=Math.max(i,Math.min(a-i,r.y)))}snapToGrid(t,e){console.log("Snapping bubble to grid. Current position:",t.x,t.y);const s=this.BUBBLE_SIZE*Math.sqrt(3)/2,a=this.BUBBLE_SIZE/2,i=this.getQuantizedBaseY(e),o=Math.max(0,Math.round((t.y-i)/s)),r=this.getTopRowOffset(e),n=o%2==0?r:0===r?this.BUBBLE_SIZE/2:0,h=Math.max(0,Math.round((t.x-a-n)/this.BUBBLE_SIZE));t.row=o,t.col=h,console.log("Grid coordinates assigned:",`row=${t.row}, col=${t.col}`,"Position preserved:",t.x,t.y)}lightenColor(t,e){const s=parseInt(t.replace("#",""),16),a=Math.round(2.55*e*100),i=(s>>16)+a,o=(s>>8&255)+a,r=(255&s)+a;return"#"+(16777216+65536*(i<255?i<1?0:i:255)+256*(o<255?o<1?0:o:255)+(r<255?r<1?0:r:255)).toString(16).slice(1)}}class E{BUBBLE_SIZE=40;createBounceEffect(t,e){const s=[];for(let a=0;a<4;a++){const a=Math.random()*Math.PI*2,i=1+2*Math.random();s.push({x:t,y:e,vx:Math.cos(a)*i,vy:Math.sin(a)*i,size:1+Math.random(),color:"#87CEEB",life:.5,maxLife:.5,type:"spark",rotation:0,rotationSpeed:0})}return{x:t,y:e,particles:s,active:!0,shockwave:{radius:0,maxRadius:this.BUBBLE_SIZE/3,intensity:.3}}}createImpactEffect(t,e,s){const a=[];for(let i=0;i<6;i++){const i=Math.random()*Math.PI*2,o=2+3*Math.random();a.push({x:t,y:e,vx:Math.cos(i)*o,vy:Math.sin(i)*o,size:2+3*Math.random(),color:s,life:.8,maxLife:.8,type:"burst",rotation:Math.random()*Math.PI*2,rotationSpeed:.2*(Math.random()-.5)})}return{x:t,y:e,particles:a,active:!0,shockwave:{radius:0,maxRadius:this.BUBBLE_SIZE,intensity:.6}}}createExplosion(t,e,s){const a=[];for(let i=0;i<15;i++){const o=2*Math.PI*i/15,r=3+5*Math.random();a.push({x:t,y:e,vx:Math.cos(o)*r,vy:Math.sin(o)*r,size:4+6*Math.random(),color:s,life:1,maxLife:1,type:"burst",rotation:Math.random()*Math.PI*2,rotationSpeed:.3*(Math.random()-.5)})}for(let i=0;i<8;i++){const s=Math.random()*Math.PI*2,i=6+4*Math.random();a.push({x:t,y:e,vx:Math.cos(s)*i,vy:Math.sin(s)*i,size:1+2*Math.random(),color:"#FFD700",life:.8,maxLife:.8,type:"spark",rotation:0,rotationSpeed:0})}for(let i=0;i<5;i++){const i=Math.random()*Math.PI*2,o=1+2*Math.random();a.push({x:t,y:e,vx:Math.cos(i)*o,vy:Math.sin(i)*o,size:8+4*Math.random(),color:this.lightenColor(s,.3),life:1.2,maxLife:1.2,type:"glow",rotation:Math.random()*Math.PI*2,rotationSpeed:.1*(Math.random()-.5)})}return{x:t,y:e,particles:a,active:!0,shockwave:{radius:0,maxRadius:2*this.BUBBLE_SIZE,intensity:1}}}updateParticles(t){t.forEach(t=>{if(t.life>0)switch(t.x+=t.vx,t.y+=t.vy,t.rotation+=t.rotationSpeed,t.type){case"burst":t.vy+=.15,t.vx*=.96,t.vy*=.96,t.life-=.025;break;case"spark":t.vy+=.05,t.vx*=.99,t.vy*=.99,t.life-=.04;break;case"glow":t.vy+=.08,t.vx*=.97,t.vy*=.97,t.life-=.015}})}lightenColor(t,e){const s=parseInt(t.replace("#",""),16),a=Math.round(2.55*e*100),i=(s>>16)+a,o=(s>>8&255)+a,r=(255&s)+a;return"#"+(16777216+65536*(i<255?i<1?0:i:255)+256*(o<255?o<1?0:o:255)+(r<255?r<1?0:r:255)).toString(16).slice(1)}}class M{canvasWidth=t(800);canvasHeight=t(600);gameCanvas=t();ctx=null;BUBBLE_SIZE=40;initializeCanvas(){if(!this.gameCanvas.value)return!1;const t=this.gameCanvas.value;if(this.ctx=t.getContext("2d"),!this.ctx)return!1;const e=t.parentElement;return e&&(this.canvasWidth.value=e.clientWidth,this.canvasHeight.value=e.clientHeight,t.width=this.canvasWidth.value,t.height=this.canvasHeight.value),!0}setCanvasSize(t,e){this.canvasWidth.value=t,this.canvasHeight.value=e,this.gameCanvas.value&&(this.gameCanvas.value.width=t,this.gameCanvas.value.height=e)}clearCanvas(){this.ctx&&this.ctx.clearRect(0,0,this.canvasWidth.value,this.canvasHeight.value)}drawBackground(){if(!this.ctx)return;const t=this.ctx.createLinearGradient(0,0,0,this.canvasHeight.value);t.addColorStop(0,"#1a1a2e"),t.addColorStop(1,"#16213e"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvasWidth.value,this.canvasHeight.value)}drawBubble(t){if(!this.ctx)return;const e=Math.round(2*t.x)/2,s=Math.round(2*t.y)/2,a=this.BUBBLE_SIZE/2-1;this.ctx.save(),this.ctx.shadowColor=t.color,this.ctx.shadowBlur=6;const i=this.ctx.createRadialGradient(e-this.BUBBLE_SIZE/6,s-this.BUBBLE_SIZE/6,0,e,s,a);i.addColorStop(0,this.lightenColor(t.color,.3)),i.addColorStop(1,t.color),this.ctx.fillStyle=i,this.ctx.beginPath(),this.ctx.arc(e,s,a,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.strokeStyle="rgba(255,255,255,0.4)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(e,s,a-3,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.shadowColor="rgba(0,0,0,0.7)",this.ctx.shadowBlur=3,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.fillStyle="#fff",this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle";const o=t.displayText||t.word.charAt(0).toUpperCase();if(t.isBomb){const t=Date.now()/1e3,i=.9+.1*Math.sin(8*t);this.ctx.save(),this.ctx.scale(i,i),this.ctx.fillStyle="#FFA500",this.ctx.font="bold 22px Arial",this.ctx.fillText("💣",e/i,(s-2)/i),this.ctx.restore(),this.ctx.fillStyle="#fff",this.ctx.font="bold 10px Arial",this.ctx.fillText(o,e,s+14),this.ctx.strokeStyle="#FF4444",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.arc(e,s,a+5,0,2*Math.PI),this.ctx.stroke(),this.ctx.setLineDash([])}else this.ctx.fillText(o,e,s);this.ctx.restore()}drawShooter(t,e,s,a){if(!this.ctx)return;this.ctx.save();const i=.8+.2*Math.sin(.008*Date.now());this.ctx.shadowColor=s,this.ctx.shadowBlur=15*i;const o=this.ctx.createRadialGradient(t.x-this.BUBBLE_SIZE/6,t.y-this.BUBBLE_SIZE/6,0,t.x,t.y,this.BUBBLE_SIZE/2);o.addColorStop(0,s),o.addColorStop(1,s),this.ctx.fillStyle=o,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,this.BUBBLE_SIZE/2,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=3,this.ctx.stroke(),this.ctx.strokeStyle="rgba(255,255,255,0.3)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,this.BUBBLE_SIZE/2-4,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.shadowColor="rgba(0,0,0,0.8)",this.ctx.shadowBlur=4,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.fillStyle="#fff",this.ctx.font="bold 18px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle";const r=a||e.charAt(0).toUpperCase();this.ctx.fillText(r,t.x,t.y),this.ctx.restore()}drawShootingBubble(t){if(!this.ctx)return;this.ctx.save(),this.ctx.shadowColor=t.color,this.ctx.shadowBlur=15;const e=.98+.02*Math.sin(.01*Date.now()),s=Math.round(2*t.x)/2,a=Math.round(2*t.y)/2,i=this.BUBBLE_SIZE/2-1,o=this.ctx.createRadialGradient(s-this.BUBBLE_SIZE/5,a-this.BUBBLE_SIZE/5,0,s,a,i);o.addColorStop(0,this.lightenColor(t.color,.5)),o.addColorStop(1,t.color),this.ctx.fillStyle=o,this.ctx.beginPath(),this.ctx.arc(s,a,i*e,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=3,this.ctx.stroke(),this.ctx.strokeStyle="rgba(255,255,255,0.6)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(s,a,(i-3)*e,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.shadowColor="rgba(0,0,0,0.9)",this.ctx.shadowBlur=5,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.fillStyle="#fff",this.ctx.font="bold 17px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle";const r=t.displayText||t.word.charAt(0).toUpperCase();this.ctx.fillText(r,s,a),this.ctx.restore()}drawExplosions(t){this.ctx&&t.forEach(t=>{t.active&&this.ctx&&(t.shockwave.intensity>0&&(this.ctx.save(),this.ctx.globalAlpha=.3*t.shockwave.intensity,this.ctx.strokeStyle="#FFD700",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.shockwave.radius,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore()),t.particles.forEach(t=>{if(t.life<=0||!this.ctx)return;const e=t.life/t.maxLife;switch(this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.rotation),this.ctx.globalAlpha=e,t.type){case"burst":this.ctx.shadowColor=t.color,this.ctx.shadowBlur=2*t.size,this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.arc(0,0,t.size*e,0,2*Math.PI),this.ctx.fill();break;case"spark":this.ctx.strokeStyle=t.color,this.ctx.lineWidth=t.size*e,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(-t.size,0),this.ctx.lineTo(t.size,0),this.ctx.stroke();break;case"glow":const s=this.ctx.createRadialGradient(0,0,0,0,0,t.size*e);s.addColorStop(0,t.color),s.addColorStop(1,"transparent"),this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(0,0,t.size*e,0,2*Math.PI),this.ctx.fill()}this.ctx.restore()}))})}drawAimLine(t,e){if(!this.ctx||!t.visible)return;const s=this.ctx;s.strokeStyle="rgba(255,255,255,0.8)",s.lineWidth=2,s.setLineDash([5,5]);const a=this.BUBBLE_SIZE/2,i=this.canvasWidth.value-this.BUBBLE_SIZE/2,o=this.BUBBLE_SIZE/2;let r=e.x,n=e.y,h=t.x-e.x,l=t.y-e.y;const c=Math.sqrt(h*h+l*l)||1;h/=c,l/=c,l>-.01&&(l=-.01),s.beginPath(),s.moveTo(r,n);let d=0;let u=0;for(;d<=2&&u++<10;){const t=(o-n)/l;let e=Number.POSITIVE_INFINITY,c=r;h>0?(e=(i-r)/h,c=i):h<0&&(e=(a-r)/h,c=a);const u=Math.min(t>0?t:Number.POSITIVE_INFINITY,e>0?e:Number.POSITIVE_INFINITY),x=r+h*u,B=n+l*u;if(s.lineTo(x,B),t>0&&t<=u+1e-6)break;r=c,n=B,h=-h,d++,s.moveTo(r,n)}s.stroke(),s.setLineDash([]),s.shadowColor="#fff",s.shadowBlur=10,s.stroke(),s.shadowBlur=0}lightenColor(t,e){const s=parseInt(t.replace("#",""),16),a=Math.round(2.55*e*100),i=(s>>16)+a,o=(s>>8&255)+a,r=(255&s)+a;return"#"+(16777216+65536*(i<255?i<1?0:i:255)+256*(o<255?o<1?0:o:255)+(r<255?r<1?0:r:255)).toString(16).slice(1)}}class S{updateAim(t,e){const s=e.getBoundingClientRect(),a=e.width/s.width,i=e.height/s.height,o=(t.clientX-s.left)*a,r=(t.clientY-s.top)*i;console.log(`Mouse: ${t.clientX}, ${t.clientY} | Canvas: ${o}, ${r} | Scale: ${a.toFixed(2)}, ${i.toFixed(2)}`);const n=e.width/2,h=e.height-50,l=o-n,c=r-h,d=Math.sqrt(l*l+c*c);return r<h-20&&d>20?{x:o,y:r}:null}getShootingVector(t,e,s){const a=e.getBoundingClientRect();if(!a)return null;const i=e.width/a.width,o=e.height/a.height,r=(t.clientX-a.left)*i,n=(t.clientY-a.top)*o;console.log(`Shooting at: ${r}, ${n} (scaled from ${t.clientX}, ${t.clientY})`);const h=e.width-20;let l=r-s.x,c=n-s.y;const d=Math.sqrt(l*l+c*c)||1;l/=d,c/=d,c>-.01&&(c=-.01);let u=s.x,x=s.y;let B=r,g=n;for(;;){const t=(20-x)/c;let e=Number.POSITIVE_INFINITY;l>0?e=(h-u)/l:l<0&&(e=(20-u)/l);const s=Math.min(t>0?t:Number.POSITIVE_INFINITY,e>0?e:Number.POSITIVE_INFINITY);B=u+l*s,g=x+c*s;break}const v=B-s.x,m=g-s.y,b=Math.sqrt(v*v+m*m)||1,p=v/b*8,f=m/b*8;return console.log(`Direction (reflected): dx=${p.toFixed(2)}, dy=${f.toFixed(2)}`),{vx:p,vy:f}}}class w{BUBBLE_SIZE=40;COLORS=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#FFB347"];checkForMatches(t,e){console.log("Checking matches for bubble:",t.word,t.x,t.y);const s=new Set,a=[],i=t=>{s.has(t.id)||(s.add(t.id),a.push(t),console.log("Found connected bubble:",t.word,t.x,t.y),e.forEach(e=>{if(e.id!==t.id&&!s.has(e.id)&&e.word===t.word){const s=e.x-t.x,a=e.y-t.y,o=Math.sqrt(s*s+a*a);console.log(`Distance between ${t.word} and ${e.word}: ${o}, BUBBLE_SIZE: ${this.BUBBLE_SIZE}`),o<=1.2*this.BUBBLE_SIZE&&(console.log("Found adjacent bubble:",e.word,e.x,e.y),i(e))}}))};i(t),console.log(`Found ${a.length} connected bubbles:`,a.map(t=>t.word));const o=a.length>=3;return o?console.log("MATCH FOUND! Removing bubbles:",a.map(t=>t.word)):console.log("No match - not enough connected bubbles"),{matchedBubbles:a,shouldRemove:o}}removeFloatingBubbles(t){const e=new Set,s=a=>{e.has(a.id)||(e.add(a.id),t.forEach(t=>{if(t.id!==a.id&&!e.has(t.id)){const e=t.x-a.x,i=t.y-a.y;Math.sqrt(e*e+i*i)<=1.1*this.BUBBLE_SIZE&&s(t)}}))};t.forEach(t=>{0===t.row&&s(t)});return{remainingBubbles:t.filter(t=>e.has(t.id)),removedBubbles:t.filter(t=>!e.has(t.id))}}setupInitialBubbles(t,e=!1){const s=[],a=this.BUBBLE_SIZE*Math.sqrt(3)/2,i=this.BUBBLE_SIZE/2,o=this.BUBBLE_SIZE/2;for(let r=0;r<t.length;r++){const n=Math.floor(r/8),h=r%8,l={x:i+(n%2==0?0:this.BUBBLE_SIZE/2)+h*this.BUBBLE_SIZE,y:o+n*a,word:t[r].word,color:this.getColorForWord(t[r].word),id:`initial-${r}`,row:n,col:h,vietnameseMeaning:t[r].meaning,displayText:e&&t[r].meaning?t[r].meaning.substring(0,2).toUpperCase():t[r].word.charAt(0).toUpperCase()};s.push(l)}return s}isGameWon(t){return 0===t.length}calculateScore(t,e){return 10*t+5*e}getColorForWord(t){let e=0;for(let a=0;a<t.length;a++)e=(e<<5)-e+t.charCodeAt(a)&4294967295;const s=Math.abs(e)%this.COLORS.length;return this.COLORS[s]}}class y{stateManager;audioSystem;physicsEngine;visualEffects;canvasRenderer;inputHandler;gameLogic;animationFrame=null;currentWords=[];vietnameseMode=!1;rowInsertTimer=null;ROW_INSERT_INTERVAL=2e4;rowAnimationActive=!1;bombHits=new Map;rowAnimationStart=0;rowAnimationDuration=600;rowShiftAmount=34;rowStartYMap=new Map;rowStartXMap=new Map;newRowBubbles=[];newRowDelays=new Map;constructor(){var t;this.stateManager=new p,this.audioSystem=m(),this.physicsEngine=(t=this.stateManager,new f(t)),this.visualEffects=new E,this.canvasRenderer=new M,this.inputHandler=new S,this.gameLogic=new w,this.rowShiftAmount=this.physicsEngine.BUBBLE_SIZE*Math.sqrt(3)/2}triggerRowInsertion(){if(this.rowAnimationActive||this.stateManager.gameOver.value)return;if(this.stateManager.shootingBubble.value)return;this.rowAnimationActive=!0,this.stateManager.setRowAnimationActive(!0),this.rowAnimationStart=performance.now(),this.rowStartYMap.clear(),this.rowStartXMap.clear(),this.newRowBubbles=[],this.newRowDelays.clear(),this.stateManager.bubbles.value.forEach(t=>{this.rowStartYMap.set(t.id,t.y),this.rowStartXMap.set(t.id,t.x);const e=this.physicsEngine.BUBBLE_SIZE*Math.sqrt(3)/2,s=this.physicsEngine.BUBBLE_SIZE/2,a=this.physicsEngine.BUBBLE_SIZE/2,i=(t.row??0)%2==0?0:this.physicsEngine.BUBBLE_SIZE/2;t.stableX=s+i+(t.col??0)*this.physicsEngine.BUBBLE_SIZE,t.stableY=a+(t.row??0)*e});const t=this.physicsEngine.BUBBLE_SIZE,e=t/2,s=this.stateManager.bubbles.value.filter(t=>0===(t.row??0)),a=(s,a)=>{const i=Math.round((s-(e+a))/t);return e+a+i*t};let i=0,o=0;s.length>0&&s.forEach(e=>{i+=Math.abs(e.x-a(e.x,0)),o+=Math.abs(e.x-a(e.x,t/2))});const r=0===(0===s.length||i<=o?0:t/2)?t/2:0,n=this.canvasRenderer.canvasWidth.value||800,h=r,l=this.physicsEngine.BUBBLE_SIZE,c=Math.max(1,Math.floor((n-10-h)/l));for(let d=0;d<c;d++){const t=this.currentWords[Math.floor(Math.random()*Math.max(1,this.currentWords.length))],e=t?.word||"·",s=this.physicsEngine.getColorForWord(e),a=d*this.physicsEngine.BUBBLE_SIZE+this.physicsEngine.BUBBLE_SIZE/2+h,i=-this.physicsEngine.BUBBLE_SIZE,o=Math.random()<.2,r={x:a,y:i,word:e,color:o?"#FF4444":s,id:`row-${Date.now()}-${d}`,row:-1,col:d,vietnameseMeaning:t?.meaning||"",displayText:this.vietnameseMode&&t?.meaning?t.meaning.substring(0,2).toUpperCase():e.charAt(0).toUpperCase(),isBomb:o};this.stateManager.addBubble(r),this.newRowBubbles.push(r),this.newRowDelays.set(r.id,60*d)}}updateRowInsertionAnimation(){if(!this.rowAnimationActive)return;const t=performance.now()-this.rowAnimationStart,e=Math.min(1,t/this.rowAnimationDuration),s=1-Math.pow(1-e,3);this.stateManager.bubbles.value.forEach(t=>{if(this.newRowDelays.has(t.id))return;const e=this.rowStartYMap.get(t.id),a=this.rowStartXMap.get(t.id);null!=e&&(t.y=e+s*this.rowShiftAmount),null!=a&&(t.x=a)});const a=this.physicsEngine.BUBBLE_SIZE/2,i=a+s*this.rowShiftAmount,o=this.stateManager.bubbles.value.filter(t=>!this.newRowDelays.has(t.id)&&0===(t.row??0));let r=!0;for(const n of this.newRowBubbles){const e=this.newRowDelays.get(n.id)||0,s=Math.max(0,t-e),h=Math.min(1,s/Math.max(1,this.rowAnimationDuration-e)),l=1-Math.pow(1-h,3),c=-this.physicsEngine.BUBBLE_SIZE,d=c+(a-c)*l;let u=i-this.rowShiftAmount-1;if(o.length>0){let t=o[0],e=Math.abs(t.x-n.x);for(let r=1;r<o.length;r++){const s=Math.abs(o[r].x-n.x);s<e&&(e=s,t=o[r])}const s=this.physicsEngine.BUBBLE_SIZE,a=Math.min(e,s),i=a>=s?0:Math.sqrt(s*s-a*a);u=Math.min(u,t.y-i-1)}n.y=Math.round(2*Math.min(d,u))/2,h<1&&(r=!1)}if(e>=1&&r){this.stateManager.bubbles.value.forEach(t=>{if(this.newRowDelays.has(t.id))return;const e=(t.row??0)+1,s=this.rowStartXMap.get(t.id);null!=s&&(t.x=s),t.row=e;const a=this.physicsEngine.BUBBLE_SIZE/2+e*this.rowShiftAmount;t.y=Math.round(2*a)/2;const i=e%2==0?0:this.physicsEngine.BUBBLE_SIZE/2,o=Math.round((t.x-(this.physicsEngine.BUBBLE_SIZE/2+i))/this.physicsEngine.BUBBLE_SIZE);t.col=Math.max(0,o)});const t=this.physicsEngine.BUBBLE_SIZE,e=t/2,s=this.stateManager.bubbles.value.filter(t=>1===(t.row??0));let i=0,o=0;s.length>0&&s.forEach(s=>{i+=Math.abs(s.x-(e+Math.round((s.x-e)/t)*t)),o+=Math.abs(s.x-(e+t/2+Math.round((s.x-(e+t/2))/t)*t))});const r=0===(0===s.length||i<=o?0:t/2)?t/2:0;this.newRowBubbles.forEach(s=>{const i=Math.round((s.x-(e+r))/t);s.col=Math.max(0,i),s.row=0,s.y=Math.round(2*a)/2}),this.stateManager.addScreenShake(4),this.audioSystem.playImpactSound(),this.stateManager.bubbles.value.forEach(t=>{delete t.stableX,delete t.stableY}),this.rowAnimationActive=!1,this.stateManager.setRowAnimationActive(!1),this.rowStartYMap.clear(),this.rowStartXMap.clear(),this.newRowDelays.clear(),this.newRowBubbles=[]}}initialize(t,e,s=!1){if(this.canvasRenderer.gameCanvas.value=t,this.currentWords=e,this.vietnameseMode=s,!this.canvasRenderer.initializeCanvas())return void console.error("Failed to initialize canvas");this.stateManager.shooterPosition.value={x:this.canvasRenderer.canvasWidth.value/2,y:this.canvasRenderer.canvasHeight.value-50};this.gameLogic.setupInitialBubbles(e,this.vietnameseMode).forEach(t=>this.stateManager.addBubble(t)),this.stateManager.selectNextShooterWord(e),this.startGameLoop(),this.rowInsertTimer&&window.clearInterval(this.rowInsertTimer),this.rowInsertTimer=window.setInterval(()=>this.triggerRowInsertion(),this.ROW_INSERT_INTERVAL)}startGameLoop(){this.animationFrame&&cancelAnimationFrame(this.animationFrame);const t=()=>{this.updateRowInsertionAnimation(),this.stateManager.updateExplosions(),this.canvasRenderer.clearCanvas();const e=this.stateManager.screenShake.value,s=this.canvasRenderer.gameCanvas.value?.getContext("2d");s&&(s.save(),s.translate(e.x,e.y),this.canvasRenderer.drawBackground(),this.stateManager.bubbles.value.forEach(t=>{this.canvasRenderer.drawBubble(t)}),this.canvasRenderer.drawExplosions(this.stateManager.explosions.value),this.canvasRenderer.drawShooter(this.stateManager.shooterPosition.value,this.stateManager.currentShooterWord.value,this.stateManager.currentShooterColor.value,this.getShooterDisplayText()),this.stateManager.shootingBubble.value&&this.canvasRenderer.drawShootingBubble(this.stateManager.shootingBubble.value),this.canvasRenderer.drawAimLine(this.stateManager.aimLine.value,this.stateManager.shooterPosition.value),s.restore()),this.gameLogic.isGameWon(this.stateManager.bubbles.value)?this.stateManager.setGameOver(!0):this.stateManager.gameOver.value||(this.animationFrame=requestAnimationFrame(t))};t()}stopGameLoop(){this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),this.rowInsertTimer&&(window.clearInterval(this.rowInsertTimer),this.rowInsertTimer=null)}updateAim(t){const e=this.canvasRenderer.gameCanvas.value;if(!e||this.stateManager.shootingBubble.value)return;const s=this.inputHandler.updateAim(t,e);this.stateManager.updateAimLine(s)}shootBubble(t){const e=this.canvasRenderer.gameCanvas.value;if(!e||this.stateManager.shootingBubble.value||!this.stateManager.currentShooterWord.value||this.rowAnimationActive)return;const s=this.inputHandler.getShootingVector(t,e,this.stateManager.shooterPosition.value);if(!s)return;this.stateManager.updateAimLine(null);const a=this.stateManager.currentShooterWord.value,i=this.currentWords.find(t=>t.word===a),o={x:this.stateManager.shooterPosition.value.x,y:this.stateManager.shooterPosition.value.y,word:a,color:this.stateManager.currentShooterColor.value,id:`shooting-${Date.now()}`,row:-1,col:-1,vietnameseMeaning:i?.meaning||"",displayText:a.charAt(0).toUpperCase()};this.stateManager.setShootingBubble(o),o.word&&this.audioSystem.playVocabularySound(o.word,"en"),this.physicsEngine.animateShootingBubble(o,s.vx,s.vy,t=>this.handleBubbleLanded(t),this.stateManager.bubbles.value,this.canvasRenderer.canvasWidth.value,this.canvasRenderer.canvasHeight.value),this.stateManager.selectNextShooterWord(this.currentWords)}restartGame(t){this.stopGameLoop(),this.currentWords=t,this.stateManager.resetGame();this.gameLogic.setupInitialBubbles(t).forEach(t=>this.stateManager.addBubble(t)),this.stateManager.selectNextShooterWord(t),this.startGameLoop(),this.rowInsertTimer&&window.clearInterval(this.rowInsertTimer),this.rowInsertTimer=window.setInterval(()=>this.triggerRowInsertion(),this.ROW_INSERT_INTERVAL)}updateVietnameseMode(t){this.vietnameseMode=t,this.stateManager.bubbles.value.forEach(e=>{t&&e.vietnameseMeaning?e.displayText=e.vietnameseMeaning.substring(0,2).toUpperCase():e.displayText=e.word.charAt(0).toUpperCase()})}getShooterDisplayText(){const t=this.stateManager.currentShooterWord.value;if(!t)return"";const e=this.currentWords.find(e=>e.word===t);return this.vietnameseMode&&e?.meaning?e.meaning.substring(0,2).toUpperCase():t.charAt(0).toUpperCase()}cleanup(){this.stopGameLoop()}handleBubbleLanded(t){const e=this.visualEffects.createImpactEffect(t.x,t.y,t.color);this.stateManager.addExplosion(e),this.audioSystem.playImpactSound(),this.stateManager.setShootingBubble(null),this.vietnameseMode&&t.vietnameseMeaning?t.displayText=t.vietnameseMeaning.substring(0,2).toUpperCase():t.displayText=t.word.charAt(0).toUpperCase(),this.physicsEngine.snapToGrid(t,this.stateManager.bubbles.value),this.stateManager.addBubble(t),this.checkBombHits(t);const s=this.gameLogic.checkForMatches(t,this.stateManager.bubbles.value);if(s.shouldRemove){s.matchedBubbles.forEach(t=>{const e=this.visualEffects.createExplosion(t.x,t.y,t.color);this.stateManager.addExplosion(e)});const t=s.matchedBubbles.map(t=>t.id);this.stateManager.removeBubbles(t);const e=this.gameLogic.calculateScore(s.matchedBubbles.length,0);this.stateManager.updateScore(e),this.stateManager.incrementWordsMatched(),this.audioSystem.playExplosionSound(),this.stateManager.addScreenShake(8),this.handleFloatingBubbles()}}handleFloatingBubbles(){const t=this.gameLogic.removeFloatingBubbles(this.stateManager.bubbles.value);if(t.removedBubbles.length>0){t.removedBubbles.forEach(t=>{const e=this.visualEffects.createImpactEffect(t.x,t.y,t.color);this.stateManager.addExplosion(e)}),this.stateManager.bubbles.value=t.remainingBubbles;const e=this.gameLogic.calculateScore(0,t.removedBubbles.length);this.stateManager.updateScore(e)}}checkBombHits(t){this.stateManager.bubbles.value.filter(e=>{if(!e.isBomb)return!1;const s=e.x-t.x,a=e.y-t.y;return Math.sqrt(s*s+a*a)<=1.1*this.physicsEngine.BUBBLE_SIZE}).forEach(t=>{const e=(this.bombHits.get(t.id)||0)+1;this.bombHits.set(t.id,e),console.log(`Bomb ${t.id} hit ${e}/2 times`),e>=2&&(this.triggerMassiveExplosion(t),this.bombHits.delete(t.id))})}triggerMassiveExplosion(t){console.log("💥 MASSIVE BOMB EXPLOSION! DEVASTATION!");for(let o=0;o<3;o++){const e=(Math.random()-.5)*this.physicsEngine.BUBBLE_SIZE*2,s=(Math.random()-.5)*this.physicsEngine.BUBBLE_SIZE*2,a=this.visualEffects.createExplosion(t.x+e,t.y+s,"#FF4444");a.shockwave.maxRadius=12*this.physicsEngine.BUBBLE_SIZE,a.particles.forEach(t=>{t.size*=4,t.maxLife*=3,t.vx*=3,t.vy*=3}),this.stateManager.addExplosion(a)}for(let o=0;o<60;o++){const e=2*Math.PI*o/60,s=20+15*Math.random(),a={x:t.x,y:t.y,particles:[{x:t.x,y:t.y,vx:Math.cos(e)*s,vy:Math.sin(e)*s,size:12+8*Math.random(),color:["#FF2222","#FF4444","#FF6666","#FFAA44","#FFFF44","#FF8844"][Math.floor(6*Math.random())],life:150,maxLife:150,type:"burst",rotation:0,rotationSpeed:.5*(Math.random()-.5)}],active:!0,shockwave:{radius:0,maxRadius:10*this.physicsEngine.BUBBLE_SIZE,intensity:1},radius:0,maxRadius:10*this.physicsEngine.BUBBLE_SIZE,intensity:1};this.stateManager.addExplosion(a)}const e=6*this.physicsEngine.BUBBLE_SIZE,s=this.stateManager.bubbles.value.filter(s=>{const a=s.x-t.x,i=s.y-t.y;return Math.sqrt(a*a+i*i)<=e}),a=s.map(t=>t.id);this.stateManager.removeBubbles(a),s.forEach(t=>{t.isBomb&&this.bombHits.delete(t.id)}),this.stateManager.addScreenShake(35),this.audioSystem.playExplosionSound(),setTimeout(()=>this.audioSystem.playExplosionSound(),100),setTimeout(()=>this.audioSystem.playExplosionSound(),200),this.stateManager.updateScore(1e3+50*s.length),console.log(`💥 BOMB DEVASTATION: Destroyed ${s.length} bubbles!`);const i=this.gameLogic.removeFloatingBubbles(this.stateManager.bubbles.value);if(i.removedBubbles.length>0){this.stateManager.removeBubbles(i.removedBubbles.map(t=>t.id));const t=this.gameLogic.calculateScore(0,i.removedBubbles.length);this.stateManager.updateScore(t)}}}const I={class:"bubble-shooter-game h-full min-h-[600px] sm:min-h-[500px] md:min-h-0 flex flex-col"},L={class:"p-4 sm:p-6 md:p-8 bg-gradient-to-r from-purple-600 to-pink-600 dark:from-purple-800 dark:to-pink-800 text-white"},C={class:"flex justify-between items-center"},_={class:"text-lg sm:text-xl md:text-2xl font-bold"},U={class:"text-sm sm:text-base opacity-90"},A={class:"text-right"},k={class:"text-2xl sm:text-3xl font-bold"},Z={class:"text-xs sm:text-sm opacity-90"},F={class:"flex-1 min-h-[450px] sm:min-h-[350px] md:min-h-0 relative bg-gradient-to-b from-blue-100 to-blue-200 dark:from-[#0a0a0a] dark:to-[#0f0f0f] overflow-hidden"},R=["viewBox"],T=["x1","y1","x2","y2"],O={class:"absolute bottom-20 left-1/2 transform -translate-x-1/2 bg-white dark:bg-[#0a0a0a] rounded-lg px-4 py-2 shadow-lg border-2 border-purple-500"},W={class:"text-center"},P={class:"text-lg sm:text-xl font-bold text-gray-800 dark:text-white"},D={class:"text-xs sm:text-sm text-gray-600 dark:text-white/70"},N={key:0,class:"absolute inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4"},Y={class:"bg-white dark:bg-[#0a0a0a] rounded-2xl p-6 sm:p-8 max-w-md w-full text-center shadow-2xl border border-gray-200 dark:border-[#0f0f0f]"},q={class:"text-xl sm:text-2xl font-bold mb-2 text-gray-800 dark:text-white"},z={class:"text-gray-600 dark:text-white/70 mb-4"},$={class:"text-sm text-gray-500 dark:text-white/60 mb-6"},G={class:"flex gap-3 justify-center"},X=b(e({__name:"BubbleShooterMode",props:{words:{},vietnameseMode:{type:Boolean}},emits:["game-complete"],setup(e,{emit:m}){const b=e,{t:p}=v(),f=m,E=new y,M=t(),S=s(()=>E.canvasRenderer.canvasWidth.value),w=s(()=>E.canvasRenderer.canvasHeight.value),X=s(()=>E.stateManager.score.value),H=s(()=>E.stateManager.wordsMatched.value),V=s(()=>E.stateManager.gameOver.value),j=s(()=>E.stateManager.currentShooterWord.value);s(()=>{const t=E.stateManager.currentShooterWord.value;if(!t)return"";const e=b.words.find(e=>e.word===t);return b.vietnameseMode&&e?.meaning?e.meaning.substring(0,2).toUpperCase():t.charAt(0).toUpperCase()});const Q=s(()=>E.stateManager.aimLine.value),J=s(()=>E.stateManager.shooterPosition.value),K=a(()=>E.stateManager.gameOver.value,t=>{t&&f("game-complete")});i(async()=>{await o(),M.value&&E.initialize(M.value,b.words,b.vietnameseMode)}),a(()=>b.vietnameseMode,t=>{E.updateVietnameseMode(t??!1)}),r(()=>{K(),E.cleanup()});const tt=t=>{E.updateAim(t)},et=t=>{E.shootBubble(t)},st=()=>{E.stopGameLoop(),E.stateManager.resetGame(),M.value&&E.initialize(M.value,b.words)};return(t,e)=>(h(),n("div",I,[l("div",L,[l("div",C,[l("div",null,[l("h2",_,c(d(p)("flashcard.bubbleShooter.title","Bubble Shooter")),1),l("p",U,c(d(p)("flashcard.bubbleShooter.instruction","Shoot bubbles to match 4 or more words!")),1)]),l("div",A,[l("div",k,c(X.value),1),l("div",Z,c(d(p)("flashcard.bubbleShooter.score","Score")),1)])])]),l("div",F,[l("canvas",{ref_key:"gameCanvas",ref:M,class:"w-full h-full cursor-crosshair",onClick:et,onMousemove:tt},null,544),Q.value.visible?(h(),n("svg",{key:0,class:"absolute inset-0 w-full h-full pointer-events-none",viewBox:`0 0 ${S.value} ${w.value}`},[l("line",{x1:J.value.x,y1:J.value.y,x2:Q.value.x,y2:Q.value.y,stroke:"rgba(255,255,255,0.7)","stroke-width":"2","stroke-dasharray":"5,5"},null,8,T)],8,R)):u("",!0),l("div",O,[l("div",W,[l("div",P,c(j.value),1),l("div",D,c(d(p)("flashcard.bubbleShooter.currentWord","Current Word")),1)])]),x(g,{name:"modal",appear:""},{default:B(()=>[V.value?(h(),n("div",N,[l("div",Y,[e[1]||(e[1]=l("div",{class:"w-16 h-16 sm:w-20 sm:h-20 mx-auto mb-4 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center animate-pulse"},[l("svg",{class:"w-8 h-8 sm:w-10 sm:h-10 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[l("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})])],-1)),l("h3",q,c(d(p)("flashcard.bubbleShooter.gameComplete","Game Complete!")),1),l("p",z,c(d(p)("flashcard.bubbleShooter.finalScore",{score:X.value})),1),l("p",$,c(d(p)("flashcard.bubbleShooter.wordsMatched",{count:H.value})),1),l("div",G,[l("button",{onClick:st,class:"px-6 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-lg font-medium transform hover:scale-105 transition-all duration-200"},c(d(p)("flashcard.bubbleShooter.playAgain","Play Again")),1),l("button",{onClick:e[0]||(e[0]=e=>t.$emit("game-complete")),class:"px-6 py-2 bg-gray-500 hover:bg-gray-600 dark:bg-[#0f0f0f] dark:hover:bg-[#1a1a1a] text-white rounded-lg font-medium transform hover:scale-105 transition-all duration-200"},c(d(p)("common.finish","Finish")),1)])])])):u("",!0)]),_:1})])]))}}),[["__scopeId","data-v-98a69fca"]]);export{X as default};
