import{u as e}from"./ui-vendor-D-J_fEQ5.js";import{u as t}from"./voiceStore-o6lhlGgY.js";import{d as a,A as r,C as l,J as o,c as n,v as i,f as s,e as u,t as c,n as d,u as v,a as p,F as g,j as b}from"./vue-vendor-Bt65BSdi.js";const m={class:"bg-white dark:bg-[#0a0a0a] rounded-xl shadow-lg border border-gray-200 dark:border-white/10 p-6"},x={class:"mb-6"},h={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},k={class:"bg-gray-50 dark:bg-[#0a0a0a]/50 rounded-lg p-4 mb-4"},y={class:"text-center"},w={class:"text-2xl font-bold text-gray-900 dark:text-white mb-2"},f={key:0,class:"text-lg text-blue-600 dark:text-blue-400 mb-4"},C={class:"text-center"},M={class:"mb-6"},j={class:"text-center"},q=["disabled"],z={key:0,class:"w-10 h-10 text-gray-600 dark:text-white/60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},A={key:1,class:"w-10 h-10 text-red-600",fill:"currentColor",viewBox:"0 0 24 24"},B={key:2,class:"w-10 h-10 text-blue-600 animate-spin",fill:"none",viewBox:"0 0 24 24"},T={class:"text-sm text-gray-600 dark:text-white/60 mb-2"},E={key:0,class:"text-lg font-mono text-blue-600 dark:text-blue-400"},H={key:0,class:"mb-6"},I={class:"bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4"},R={class:"flex items-center justify-between"},V={class:"flex items-center space-x-3"},L={class:"text-blue-700 dark:text-blue-300 font-medium"},P={key:1,class:"mb-6"},U={class:"flex items-center justify-between mb-3"},F={class:"w-full bg-gray-200 dark:bg-white/10 rounded-full h-3 mb-3"},Q={key:2,class:"mb-6"},S={key:0,class:"mt-3 p-4 bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 rounded-lg"},$={class:"space-y-2"},J={class:"flex justify-between items-center"},N={class:"flex space-x-4"},_={class:"flex space-x-4"},D=["disabled"],G=a({__name:"PronunciationExercise",props:{question:{},questionIndex:{},totalQuestions:{}},emits:["answer","next","complete"],setup(a,{emit:G}){const{t:K}=e(),O=(e,t,a)=>{try{const r=K(e,a);return"string"==typeof r&&r!==e?r:t}catch{return t}},{playAudio:Y}=t(),W=a,X=G,Z=r(!0),ee=r(!1),te=r(!1),ae=r(null),re=r(0),le=r(null),oe=r(!1),ne=r(null),ie=r([]),se=r(null),ue=l(()=>te.value?O("grammar.practice.pronunciation.processing","Processing..."):ee.value?O("grammar.practice.pronunciation.recording","Recording..."):ae.value?O("grammar.practice.pronunciation.recorded","Recorded"):O("grammar.practice.pronunciation.ready","Ready to record")),ce=async()=>{ee.value?ve():await de()},de=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});ne.value=new MediaRecorder(e),ie.value=[],re.value=0,ne.value.ondataavailable=e=>{ie.value.push(e.data)},ne.value.onstop=()=>{const t=new Blob(ie.value,{type:"audio/wav"});ae.value=t,e.getTracks().forEach(e=>e.stop())},ne.value.start(),ee.value=!0,se.value=setInterval(()=>{re.value+=1,re.value>=10&&ve()},1e3)}catch(e){console.error("Error accessing microphone:",e),alert(O("grammar.practice.pronunciation.microphoneError","Unable to access microphone. Please check your browser permissions and try again."))}},ve=()=>{ne.value&&"inactive"!==ne.value.state&&ne.value.stop(),ee.value=!1,se.value&&(clearInterval(se.value),se.value=null)},pe=async()=>{try{await Y(W.question.targetText)}catch(e){console.error("Error playing target audio:",e)}},ge=()=>{if(ae.value){new Audio(URL.createObjectURL(ae.value)).play()}},be=()=>{ae.value=null,re.value=0,le.value=null},me=async()=>{if(ae.value){te.value=!0;try{await new Promise(e=>setTimeout(e,2e3));const e=Math.floor(40*Math.random())+60;le.value=e,X("answer",{isCorrect:e>=70,score:e,targetText:W.question.targetText})}catch(e){console.error("Error analyzing pronunciation:",e)}finally{te.value=!1}}},xe=()=>{be(),oe.value=!1},he=()=>{W.questionIndex===W.totalQuestions-1?X("complete"):(xe(),X("next"))};return o(()=>{if(Z.value=!1,se.value&&(clearInterval(se.value),se.value=null),ne.value&&"inactive"!==ne.value.state)try{ne.value.stop()}catch(e){console.warn("Error stopping media recorder:",e)}ne.value=null}),(e,t)=>{return i(),n("div",m,[s("div",x,[s("h3",h,c(O("grammar.practice.pronunciation.instruction","Pronounce the following correctly")),1),s("div",k,[s("div",y,[s("div",w,c(e.question.targetText),1),e.question.phonetic?(i(),n("div",f,c(e.question.phonetic),1)):u("",!0)]),s("div",C,[s("button",{onClick:pe,class:"inline-flex items-center space-x-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},[t[1]||(t[1]=s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.536 8.464a5 5 0 010 7.072m-2.036-5.036a2.5 2.5 0 010 3.536M6 10h4l4.5-4.5v9L10 10H6V8z"})],-1)),s("span",null,c(O("grammar.practice.pronunciation.listen","Listen")),1)])])])]),s("div",M,[s("div",j,[s("button",{onClick:ce,disabled:te.value,class:d(["w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all duration-200 mb-4",ee.value?"border-red-500 bg-red-100 dark:bg-red-900/30 animate-pulse":"border-gray-300 dark:border-white/10 bg-gray-100 dark:bg-[#0a0a0a] hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/30",te.value?"opacity-50 cursor-not-allowed":"cursor-pointer"])},[ee.value||te.value?ee.value?(i(),n("svg",A,t[3]||(t[3]=[s("rect",{x:"6",y:"6",width:"12",height:"12",rx:"2"},null,-1)]))):(i(),n("svg",B,t[4]||(t[4]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(i(),n("svg",z,t[2]||(t[2]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"},null,-1)])))],10,q),s("div",T,c(ue.value),1),ee.value||re.value>0?(i(),n("div",E,c((a=re.value,`${Math.floor(a/60)}:${(a%60).toString().padStart(2,"0")}`)),1)):u("",!0)])]),ae.value&&!ee.value?(i(),n("div",H,[s("div",I,[s("div",R,[s("div",V,[s("button",{onClick:ge,class:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},t[5]||(t[5]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h8m2-10V9a2 2 0 01-2 2H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2z"})],-1)])),s("span",L,c(O("grammar.practice.pronunciation.yourRecording","Your recording")),1)]),s("button",{onClick:be,class:"p-2 text-gray-500 dark:text-white/60 hover:text-red-600 dark:hover:text-red-400 transition-colors"},t[6]||(t[6]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]))])])])):u("",!0),null!==le.value?(i(),n("div",P,[s("div",{class:d(["p-4 rounded-lg border",le.value>=80?"bg-green-50 dark:bg-green-900/30 border-green-200 dark:border-green-700":le.value>=60?"bg-yellow-50 dark:bg-yellow-900/30 border-yellow-200 dark:border-yellow-700":"bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-700"])},[s("div",U,[s("h4",{class:d(["font-medium",le.value>=80?"text-green-800 dark:text-green-200":le.value>=60?"text-yellow-800 dark:text-yellow-200":"text-red-800 dark:text-red-200"])},c(v(K)("grammar.practice.pronunciation.feedback")),3),s("div",{class:d(["text-2xl font-bold",le.value>=80?"text-green-600 dark:text-green-400":le.value>=60?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"])},c(le.value)+"% ",3)]),s("div",F,[s("div",{class:d(["h-3 rounded-full transition-all duration-500",le.value>=80?"bg-green-600":le.value>=60?"bg-yellow-600":"bg-red-600"]),style:p({width:`${le.value}%`})},null,6)]),s("p",{class:d(["text-sm",le.value>=80?"text-green-700 dark:text-green-300":le.value>=60?"text-yellow-700 dark:text-yellow-300":"text-red-700 dark:text-red-300"])},c(null===le.value?"":le.value>=90?O("grammar.practice.pronunciation.excellent","Excellent pronunciation!"):le.value>=80?O("grammar.practice.pronunciation.good","Good pronunciation!"):le.value>=70?O("grammar.practice.pronunciation.fair","Fair pronunciation. Keep practicing!"):O("grammar.practice.pronunciation.needsImprovement","Needs improvement. Try again!")),3)],2)])):u("",!0),e.question.tips&&e.question.tips.length>0?(i(),n("div",Q,[s("button",{onClick:t[0]||(t[0]=e=>oe.value=!oe.value),class:"flex items-center space-x-2 text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors"},[t[7]||(t[7]=s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})],-1)),s("span",null,c(O("grammar.practice.pronunciation.tips","Tips")),1)]),oe.value?(i(),n("div",S,[s("ul",$,[(i(!0),n(g,null,b(e.question.tips,e=>(i(),n("li",{key:e,class:"text-sm text-blue-700 dark:text-blue-300 flex items-start space-x-2"},[t[8]||(t[8]=s("span",{class:"text-blue-500 mt-1"},"â€¢",-1)),s("span",null,c(e),1)]))),128))])])):u("",!0)])):u("",!0),s("div",J,[s("div",N,[null!==le.value&&le.value<80?(i(),n("button",{key:0,onClick:xe,class:"flex items-center space-x-2 px-4 py-2 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors"},[t[9]||(t[9]=s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),s("span",null,c(O("grammar.practice.pronunciation.tryAgain","Try again")),1)])):u("",!0)]),s("div",_,[null===le.value?(i(),n("button",{key:0,onClick:me,disabled:!ae.value,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"},c(O("grammar.practice.pronunciation.analyze","Analyze pronunciation")),9,D)):(i(),n("button",{key:1,onClick:he,class:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"},c(e.questionIndex===e.totalQuestions-1?O("grammar.practice.finish","Finish"):O("grammar.practice.next","Next")),1))])])]);var a}}});export{G as default};
