import{d as e,A as a,C as t,D as l,I as r,J as s,c as o,v as i,f as n,e as u,t as d,a as c,M as v,_ as g,F as b,j as p,n as y,a6 as x,y as m,w as k,u as h,g as w}from"./vue-vendor-Bt65BSdi.js";import{u as f}from"./ui-vendor-D-J_fEQ5.js";import{u as q}from"./voiceStore-o6lhlGgY.js";import{V as E}from"./utils-vendor-DwIcHP6x.js";const B={class:"bg-white dark:bg-[#0a0a0a] rounded-xl shadow-lg border border-gray-200 dark:border-white/10 p-6"},U={class:"mb-8"},C={class:"text-center"},T={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},D={class:"bg-gray-50 dark:bg-[#0a0a0a]/50 rounded-lg p-6 mb-4"},S={class:"flex items-center justify-center space-x-6 mb-4"},A=["disabled"],G={key:0,class:"w-8 h-8 ml-1",fill:"currentColor",viewBox:"0 0 24 24"},P={key:1,class:"w-8 h-8",fill:"currentColor",viewBox:"0 0 24 24"},j=["disabled"],R={class:"mb-4"},L={class:"flex justify-between text-xs text-gray-500 dark:text-white/60 mt-1"},V={class:"flex items-center justify-center space-x-4 text-sm text-gray-600 dark:text-white/60"},M={class:"flex items-center space-x-1"},Y={key:0,class:"flex items-center space-x-1"},F={key:0,class:"text-gray-500 dark:text-white/60"},N={key:0,class:"mb-6"},I={class:"block text-sm font-medium text-gray-700 dark:text-white/80 mb-2"},_=["placeholder"],H={class:"space-y-6"},z={class:"text-lg font-semibold text-gray-900 dark:text-white border-b border-gray-200 dark:border-white/10 pb-2"},Q={class:"space-y-6"},$={class:"mb-4"},J={class:"font-medium text-gray-900 dark:text-white mb-2"},O={key:0,class:"space-y-2"},W=["name","value","onUpdate:modelValue","disabled"],X={class:"text-gray-900 dark:text-white"},K={class:"ml-auto"},Z={key:0,class:"w-5 h-5 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ee={key:1,class:"w-5 h-5 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ae={key:1,class:"space-y-2"},te=["onUpdate:modelValue","disabled","placeholder"],le={key:0,class:"text-sm text-green-600 dark:text-green-400"},re={key:2,class:"space-y-2"},se={class:"text-sm text-gray-600 dark:text-white/60 mb-2"},oe={class:"flex items-center space-x-3"},ie={class:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium"},ne={class:"text-gray-900 dark:text-white"},ue={key:0,class:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700 rounded-lg"},de={class:"text-sm text-yellow-800 dark:text-yellow-200"},ce={key:1,class:"mt-8 p-4 bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 rounded-lg"},ve={class:"grid grid-cols-3 gap-4 text-center"},ge={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},be={class:"text-sm text-gray-600 dark:text-white/60"},pe={class:"text-2xl font-bold text-red-600 dark:text-red-400"},ye={class:"text-sm text-gray-600 dark:text-white/60"},xe={class:"text-2xl font-bold text-green-600 dark:text-green-400"},me={class:"text-sm text-gray-600 dark:text-white/60"},ke={class:"flex justify-between items-center mt-8"},he={class:"flex space-x-4"},we={class:"flex space-x-4"},fe=["disabled"],qe={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ee={class:"bg-white dark:bg-[#0a0a0a] rounded-xl shadow-2xl border border-gray-200 dark:border-white/10 p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto"},Be={class:"flex items-center justify-between mb-4"},Ue={class:"text-lg font-semibold text-gray-900 dark:text-white"},Ce={class:"prose dark:prose-invert max-w-none"},Te={class:"text-gray-800 dark:text-gray-200 leading-relaxed"},De=e({__name:"ListeningExercise",props:{question:{},questionIndex:{},totalQuestions:{},difficulty:{}},emits:["answer","next","complete"],setup(e,{emit:De}){const{t:Se}=f(),Ae=(e,a,t)=>{try{const l=Se(e,t);return"string"==typeof l&&l!==e?l:a}catch{return a}},{playAudio:Ge}=q();let Pe=null;const je=a(!1);a("");const Re=e,Le=De,Ve=a([]),Me=a(""),Ye=a(!1),Fe=a(!1),Ne=a(!1),Ie=a(!1),_e=a(0),He=a(0),ze=a(0),Qe=a(3),$e=a(null),Je=a(null),Oe=a(!1),We=t(()=>!!Re.question?.questions&&(Ve.value.length===Re.question.questions.length&&Ve.value.every(e=>null!=e&&""!==e))),Xe=t(()=>Re.question?.questions?Re.question.questions.filter((e,a)=>aa(a)).length:0),Ke=t(()=>Re.question.questions.length-Xe.value),Ze=t(()=>Re.question.questions.length>0?Math.round(Xe.value/Re.question.questions.length*100):0),ea=t(()=>{if(console.log("DEBUG - Question difficulty:",Re.question.difficulty),console.log("DEBUG - Global difficulty:",Re.difficulty),console.log("DEBUG - Explicit playbackSpeed:",Re.question.playbackSpeed),Re.question.playbackSpeed)return console.log("DEBUG - Using explicit playbackSpeed:",Re.question.playbackSpeed),Re.question.playbackSpeed;const e=Re.question.difficulty||Re.difficulty;let a;switch(console.log("DEBUG - Final difficulty used:",e),e){case"easy":a=.75;break;case"medium":default:a=1;break;case"hard":a=3.25}return console.log("DEBUG - Computed playback speed:",a),a}),aa=e=>{const a=Ve.value[e],t=Re.question.questions[e].correctAnswer,l=Re.question.questions[e].type;return"fill-blank"===l?a?.toLowerCase().trim()===t?.toLowerCase().trim():"ordering"===l?JSON.stringify(a)===JSON.stringify(t):a===t},ta=()=>{if(!(Qe.value<=0))return je.value?Oe.value&&Pe&&Pe.playVideo&&Pe.pauseVideo?void(Ie.value?Pe.pauseVideo():(Pe.playVideo(),Qe.value>0&&Qe.value--)):void console.warn("YouTube player not ready yet"):void($e.value&&(Ie.value?$e.value.pause():($e.value.play(),Qe.value>0&&Qe.value--)))},la=()=>{if(je.value)Pe&&Pe.seekTo&&(Pe.seekTo(0),_e.value=0,ze.value=0);else{if(!$e.value)return;$e.value.currentTime=0,_e.value=0,ze.value=0}},ra=()=>{console.log("DEBUG - updatePlaybackSpeed called!"),console.log("DEBUG - Current playbackSpeed.value:",ea.value),console.log("DEBUG - isYouTubeAudio.value:",je.value),console.log("DEBUG - audio.value exists:",!!$e.value),je.value?Pe&&Pe.setPlaybackRate?(console.log("DEBUG - Setting YouTube playback rate to:",ea.value),Pe.setPlaybackRate(parseFloat(ea.value.toString()))):console.log("DEBUG - YouTube player not ready for setPlaybackRate"):$e.value?(console.log("DEBUG - Setting audio playback rate to:",ea.value),console.log("DEBUG - Audio playbackRate BEFORE setting:",$e.value.playbackRate),$e.value.playbackRate=parseFloat(ea.value.toString()),console.log("DEBUG - Audio playbackRate AFTER setting:",$e.value.playbackRate),setTimeout(()=>{console.log("DEBUG - Audio playbackRate after 100ms:",$e.value?.playbackRate),$e.value&&$e.value.playbackRate!==parseFloat(ea.value.toString())&&(console.log("DEBUG - Playback rate was reset! Force re-applying..."),$e.value.playbackRate=parseFloat(ea.value.toString()),console.log("DEBUG - Force-applied playbackRate:",$e.value.playbackRate))},100)):console.log("DEBUG - No audio element available to set playback rate")},sa=e=>{if(!Je.value)return;const a=Je.value.getBoundingClientRect(),t=(e.clientX-a.left)/a.width*He.value;je.value?Pe&&Pe.seekTo&&(Pe.seekTo(t,!0),_e.value=t):$e.value&&($e.value.currentTime=t,_e.value=t)},oa=()=>{$e.value&&(_e.value=$e.value.currentTime,ze.value=He.value>0?_e.value/He.value*100:0)},ia=()=>{if(!We.value)return;Ye.value=!0;const e=Xe.value===Re.question.questions.length;Le("answer",{isCorrect:e,correctAnswers:Xe.value,totalQuestions:Re.question.questions.length})},na=()=>{Re.questionIndex===Re.totalQuestions-1?Le("complete"):(ua(),Le("next"))},ua=()=>{Ve.value=[],Me.value="",Ye.value=!1,Fe.value=!1,Qe.value=Re.question.maxPlays||3,la()},da=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,ca=e=>{je.value=!0;const a=document.createElement("div");if(a.id=`youtube-player-${Date.now()}`,a.style.position="absolute",a.style.left="-9999px",a.style.top="-9999px",a.style.width="1px",a.style.height="1px",document.body.appendChild(a),window.YT)va(e,a.id);else{const t=document.createElement("script");t.src="https://www.youtube.com/iframe_api",document.head.appendChild(t),window.onYouTubeIframeAPIReady=()=>{va(e,a.id)}}},va=(e,a)=>{Pe=new window.YT.Player(a,{height:"1",width:"1",videoId:e,playerVars:{autoplay:0,controls:0,disablekb:1,fs:0,iv_load_policy:3,modestbranding:1,rel:0,showinfo:0},events:{onReady:e=>{Ne.value=!0,Oe.value=!0,He.value=e.target.getDuration()||0,ra()},onStateChange:e=>{const a=e.data;a===window.YT.PlayerState.PLAYING?Ie.value=!0:a!==window.YT.PlayerState.PAUSED&&a!==window.YT.PlayerState.ENDED||(Ie.value=!1,a===window.YT.PlayerState.ENDED&&(_e.value=0,ze.value=0))}}});setInterval(()=>{if(Pe&&Pe.getCurrentTime&&Ie.value){const e=Pe.getCurrentTime();_e.value=e,He.value>0&&(ze.value=e/He.value*100)}},1e3)},ga=()=>{let e=Re.question.audioUrl;if(e.startsWith("youtube:")){const a=e.replace("youtube:","");return void ca(a)}if(e.includes("youtube.com/watch")||e.includes("youtu.be/")){let a="";if(e.includes("youtube.com/watch")){a=new URLSearchParams(e.split("?")[1]).get("v")||""}else e.includes("youtu.be/")&&(a=e.split("youtu.be/")[1].split("?")[0]);if(a)return void ca(a)}$e.value=new Audio(e),$e.value.addEventListener("loadedmetadata",()=>{He.value=$e.value.duration,Ne.value=!0,ra()}),$e.value.addEventListener("timeupdate",oa),$e.value.addEventListener("play",()=>{Ie.value=!0,ra()}),$e.value.addEventListener("pause",()=>{Ie.value=!1}),$e.value.addEventListener("ended",()=>{Ie.value=!1,_e.value=0,ze.value=0})};return l(ea,e=>{ra()},{immediate:!1}),l(()=>Re.question,(e,a)=>{e&&a&&e.audioUrl!==a.audioUrl&&($e.value&&($e.value.pause(),$e.value=null),Pe&&(Pe.destroy(),Pe=null),Ne.value=!1,Ie.value=!1,_e.value=0,He.value=0,ze.value=0,Qe.value=e.maxPlays||3,je.value=!1,Oe.value=!1,ga())},{deep:!0}),r(()=>{Ve.value=new Array(Re.question.questions?.length||0).fill(null),Qe.value=Re.question.maxPlays||3,ga()}),s(()=>{$e.value&&($e.value.pause(),$e.value=null)}),(e,a)=>(i(),o("div",B,[n("div",U,[n("div",C,[n("h3",T,d(Ae("grammar.practice.exercises.listening.instruction","Listen carefully and answer the questions")),1),n("div",D,[n("div",S,[n("button",{onClick:ta,disabled:!Ne.value,class:"w-16 h-16 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-full flex items-center justify-center transition-colors shadow-lg"},[Ie.value?(i(),o("svg",P,a[4]||(a[4]=[n("rect",{x:"6",y:"4",width:"4",height:"16"},null,-1),n("rect",{x:"14",y:"4",width:"4",height:"16"},null,-1)]))):(i(),o("svg",G,a[3]||(a[3]=[n("path",{d:"M8 5v14l11-7z"},null,-1)])))],8,A),n("button",{onClick:la,disabled:!Ne.value,class:"p-3 bg-gray-300 dark:bg-white/10 hover:bg-gray-400 dark:hover:bg-white/15 disabled:bg-gray-200 dark:disabled:bg-white/5 text-gray-700 dark:text-white/80 rounded-full transition-colors"},a[5]||(a[5]=[n("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]),8,j)]),n("div",R,[n("div",{class:"w-full bg-gray-200 dark:bg-white/10 rounded-full h-2 cursor-pointer",onClick:sa,ref_key:"progressBar",ref:Je},[n("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-100",style:c({width:`${ze.value}%`})},null,4)],512),n("div",L,[n("span",null,d(da(_e.value)),1),n("span",null,d(da(He.value)),1)])]),n("div",V,[n("div",M,[a[6]||(a[6]=n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.536 8.464a5 5 0 010 7.072m-2.036-5.036a2.5 2.5 0 010 3.536M6 10h4l4.5-4.5v9L10 10H6V8z"})],-1)),n("span",null,d(Ae("grammar.practice.exercises.listening.playsLeft","Plays left"))+": "+d(Qe.value),1)]),e.question.allowNotes?(i(),o("div",Y,[a[7]||(a[7]=n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)),n("span",null,d(Ae("grammar.practice.exercises.listening.notesAllowed","Notes are allowed")),1)])):u("",!0)])]),Ne.value?u("",!0):(i(),o("div",F,d(Ae("grammar.practice.exercises.listening.loading","Loading"))+"... ",1))])]),e.question.allowNotes?(i(),o("div",N,[n("label",I,d(Ae("grammar.practice.exercises.listening.takeNotes","Take notes")),1),v(n("textarea",{"onUpdate:modelValue":a[0]||(a[0]=e=>Me.value=e),placeholder:Ae("grammar.practice.exercises.listening.notesPlaceholder","Type your notes here..."),class:"w-full h-32 px-4 py-2 border border-gray-300 dark:border-white/10 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-[#0a0a0a] text-gray-900 dark:text-white resize-none"},null,8,_),[[g,Me.value]])])):u("",!0),n("div",H,[n("h4",z,d(Ae("grammar.practice.exercises.listening.questions","Questions")),1),n("div",Q,[(i(!0),o(b,null,p(e.question.questions,(e,t)=>(i(),o("div",{key:t,class:"border border-gray-200 dark:border-white/10 rounded-lg p-4"},[n("div",$,[n("h5",J,d(t+1)+". "+d(e.question),1),"multiple-choice"===e.type?(i(),o("div",O,[(i(!0),o(b,null,p(e.options,(l,r)=>(i(),o("label",{key:r,class:y(["flex items-start space-x-3 p-3 rounded-lg cursor-pointer transition-all",Ve.value[t]===r?"bg-blue-50 dark:bg-blue-900/30 border border-blue-300 dark:border-blue-600":"bg-gray-50 dark:bg-[#0a0a0a]/50 hover:bg-gray-100 dark:hover:bg-[#0a0a0a]/70 border border-transparent",Ye.value&&r===e.correctAnswer?"bg-green-50 dark:bg-green-900/30 border border-green-300 dark:border-green-600":"",Ye.value&&Ve.value[t]===r&&r!==e.correctAnswer?"bg-red-50 dark:bg-red-900/30 border border-red-300 dark:border-red-600":""])},[v(n("input",{type:"radio",name:`question-${t}`,value:r,"onUpdate:modelValue":e=>Ve.value[t]=e,disabled:Ye.value,class:"mt-1"},null,8,W),[[x,Ve.value[t]]]),n("span",X,d(l),1),n("div",K,[Ye.value&&r===e.correctAnswer?(i(),o("svg",Z,a[8]||(a[8]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):Ye.value&&Ve.value[t]===r&&r!==e.correctAnswer?(i(),o("svg",ee,a[9]||(a[9]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)]))):u("",!0)])],2))),128))])):"fill-blank"===e.type?(i(),o("div",ae,[v(n("input",{"onUpdate:modelValue":e=>Ve.value[t]=e,disabled:Ye.value,placeholder:Ae("grammar.practice.exercises.listening.fillBlank","Type the missing word/phrase"),class:y(["w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",Ye.value?aa(t)?"border-green-500 bg-green-50 dark:bg-green-900/30":"border-red-500 bg-red-50 dark:bg-red-900/30":"border-gray-300 dark:border-white/10 bg-white dark:bg-[#0a0a0a]","text-gray-900 dark:text-white"])},null,10,te),[[g,Ve.value[t]]]),Ye.value&&!aa(t)?(i(),o("div",le,d(Ae("grammar.practice.exercises.listening.correctAnswer","Correct answer"))+": "+d(e.correctAnswer),1)):u("",!0)])):"ordering"===e.type?(i(),o("div",re,[n("div",se,d(Ae("grammar.practice.exercises.listening.dragToOrder","Drag to order")),1),m(h(E),{modelValue:Ve.value[t],"onUpdate:modelValue":e=>Ve.value[t]=e,disabled:Ye.value,class:"space-y-2","item-key":"id"},{item:k(({element:e,index:a})=>[n("div",{class:y(["p-3 bg-gray-50 dark:bg-[#0a0a0a] rounded-lg border cursor-move",Ye.value&&a===e.correctPosition?"border-green-500 bg-green-50 dark:bg-green-900/30":Ye.value&&a!==e.correctPosition?"border-red-500 bg-red-50 dark:bg-red-900/30":"border-gray-200 dark:border-white/10"])},[n("div",oe,[n("span",ie,d(a+1),1),n("span",ne,d(e.text),1)])],2)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])])):u("",!0)]),Ye.value&&e.explanation?(i(),o("div",ue,[n("p",de,[n("strong",null,d(Ae("grammar.practice.exercises.explanation","Explanation"))+":",1),w(" "+d(e.explanation),1)])])):u("",!0)]))),128))])]),Ye.value?(i(),o("div",ce,[n("div",ve,[n("div",null,[n("div",ge,d(Xe.value),1),n("div",be,d(Ae("grammar.practice.exercises.listening.correct","Correct")),1)]),n("div",null,[n("div",pe,d(Ke.value),1),n("div",ye,d(Ae("grammar.practice.exercises.listening.incorrect","Incorrect")),1)]),n("div",null,[n("div",xe,d(Ze.value)+"%",1),n("div",me,d(Ae("grammar.practice.exercises.listening.accuracy","Accuracy")),1)])])])):u("",!0),n("div",ke,[n("div",he,[e.question.transcript&&Ye.value?(i(),o("button",{key:0,onClick:a[1]||(a[1]=e=>Fe.value=!Fe.value),class:"flex items-center space-x-2 px-4 py-2 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors"},[a[10]||(a[10]=n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),n("span",null,d(Fe.value?Ae("grammar.practice.exercises.listening.hideTranscript","Hide transcript"):Ae("grammar.practice.exercises.listening.showTranscript","Show transcript")),1)])):u("",!0)]),n("div",we,[Ye.value?(i(),o("button",{key:1,onClick:na,class:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"},d(e.questionIndex===e.totalQuestions-1?Ae("grammar.practice.exercises.finish","Finish"):Ae("grammar.practice.exercises.next","Next")),1)):(i(),o("button",{key:0,onClick:ia,disabled:!We.value,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"},d(Ae("grammar.practice.exercises.checkAnswer","Check answer")),9,fe))])]),Fe.value?(i(),o("div",qe,[n("div",Ee,[n("div",Be,[n("h3",Ue,d(Ae("grammar.practice.exercises.listening.transcript","Transcript")),1),n("button",{onClick:a[2]||(a[2]=e=>Fe.value=!1),class:"p-2 rounded-lg text-gray-500 dark:text-white/60 hover:text-gray-700 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-white/10 transition-colors"},a[11]||(a[11]=[n("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),n("div",Ce,[n("p",Te,d(e.question.transcript),1)])])])):u("",!0)]))}});export{De as default};
